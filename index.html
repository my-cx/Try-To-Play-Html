<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语阅读理解学习工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/v4-shims.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        accent: '#f59e0b',
                        success: '#10b981',
                        warning: '#f59e0b',
                        error: '#ef4444',
                        light: '#f8fafc',
                        dark: '#1e293b'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-gentle': 'bounceGentle 0.6s ease-in-out',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .hover-scale {
                transition: transform 0.2s ease;
            }
            .hover-scale:hover {
                transform: scale(1.05);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        @keyframes bounceGentle {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        .sentence-item {
            transition: all 0.3s ease;
        }
        
        .sentence-item:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .word-highlight {
            background-color: #fef3c7;
            padding: 2px 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .word-highlight:hover {
            background-color: #fde68a;
            transform: scale(1.05);
        }
        
        .translation-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .translation-content.show {
            max-height: 500px;
        }
        
        .upload-area {
            transition: all 0.3s ease;
        }
        
        .upload-area.dragover {
            background-color: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .theme-toggle {
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            transform: rotate(15deg);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-light to-blue-50 dark:from-dark dark:to-slate-900 transition-all duration-300">
    <!-- 导航栏 -->
    <nav class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-md shadow-lg sticky top-0 z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-primary to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fa fa-book text-white text-lg"></i>
                    </div>
                    <h1 class="text-xl font-bold text-slate-800 dark:text-white font-inter">英语阅读理解学习工具</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="themeToggle" class="theme-toggle p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
                        <i class="fa fa-moon-o dark:hidden text-slate-600"></i>
                        <i class="fa fa-sun-o hidden dark:block text-yellow-400"></i>
                    </button>
                    <button id="helpBtn" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
                        <i class="fa fa-question-circle text-slate-600 dark:text-slate-300"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- 欢迎区域 -->
        <div id="welcomeSection" class="text-center mb-12 animate-fade-in">
            <div class="mb-8">
                <div class="w-24 h-24 bg-gradient-to-r from-primary to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl animate-bounce-gentle">
                    <i class="fa fa-book text-white text-3xl"></i>
                </div>
                <h2 class="text-4xl font-bold text-slate-800 dark:text-white mb-4 font-inter">提升你的英语阅读能力</h2>
                <p class="text-xl text-slate-600 dark:text-slate-300 max-w-3xl mx-auto">
                    上传英语文章，标记生词，查看翻译，生成练习句子。让英语学习变得更高效！
                </p>
            </div>

            <!-- 上传区域 -->
            <div id="uploadArea" class="upload-area border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-2xl p-8 max-w-2xl mx-auto hover:border-primary dark:hover:border-primary transition-all duration-300 cursor-pointer">
                <input type="file" id="fileInput" accept=".txt" class="hidden">
                <div class="space-y-4">
                    <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto">
                        <i class="fa fa-cloud-upload text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-slate-800 dark:text-white">上传英语文章</h3>
                    <p class="text-slate-600 dark:text-slate-400">支持 .txt 格式文件</p>
                    <button id="browseBtn" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 hover-scale shadow-lg">
                        <i class="fa fa-folder-open mr-2"></i>浏览文件
                    </button>
                </div>
                <p class="mt-4 text-sm text-slate-500 dark:text-slate-500">或者拖放文件到这里</p>
            </div>

            <!-- 示例文章 -->
            <div class="mt-8 max-w-2xl mx-auto">
                <p class="text-slate-600 dark:text-slate-400 mb-4">快速体验？试试示例文章：</p>
                <button id="loadSampleBtn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 hover-scale shadow-lg">
                    <i class="fa fa-file-text-o mr-2"></i>加载示例文章
                </button>
            </div>
        </div>

        <!-- 文章处理区域 -->
        <div id="articleSection" class="hidden animate-slide-up">
            <!-- 文章信息栏 -->
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-6 mb-8">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center space-x-4">
                        <button id="uploadAnotherBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 hover-scale">
                            <i class="fa fa-upload mr-2"></i>上传新文章
                        </button>
                        <button id="clearAllBtn" class="bg-error hover:bg-error/90 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 hover-scale">
                            <i class="fa fa-trash mr-2"></i>清空
                        </button>
                    </div>
                    <div class="flex items-center space-x-6">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-primary dark:text-primary" id="wordCount">0</div>
                            <div class="text-sm text-slate-600 dark:text-slate-400">总单词数</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-accent dark:text-accent" id="sentenceCount">0</div>
                            <div class="text-sm text-slate-600 dark:text-slate-400">句子数</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-error dark:text-error" id="unknownWordCount">0</div>
                            <div class="text-sm text-slate-600 dark:text-slate-400">生词数</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 控制按钮 -->
            <div class="flex flex-wrap gap-4 mb-8">
                <button id="showAllTranslationsBtn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 hover-scale shadow-lg">
                    <i class="fa fa-language mr-2"></i>显示全部翻译
                </button>
                <button id="hideAllTranslationsBtn" class="bg-slate-500 hover:bg-slate-600 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 hover-scale shadow-lg">
                    <i class="fa fa-eye-slash mr-2"></i>隐藏全部翻译
                </button>
                <button id="generateAIPromptBtn" class="bg-accent hover:bg-accent/90 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 hover-scale shadow-lg">
                    <i class="fa fa-magic mr-2"></i>生成AI练习句子
                </button>
                <button id="exportWordsBtn" class="bg-success hover:bg-success/90 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 hover-scale shadow-lg">
                    <i class="fa fa-download mr-2"></i>导出生词列表
                </button>
            </div>

            <!-- 文章内容 -->
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-8 mb-8">
                <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-6 flex items-center">
                    <i class="fa fa-file-text-o mr-3 text-primary"></i>文章内容
                </h3>
                <div id="articleContent" class="space-y-8">
                    <!-- 句子会动态添加到这里 -->
                </div>
            </div>

            <!-- 生词列表 -->
            <div id="unknownWordsSection" class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-8">
                <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-6 flex items-center">
                    <i class="fa fa-list mr-3 text-error"></i>生词列表
                </h3>
                <div id="unknownWordsList" class="flex flex-wrap gap-3">
                    <!-- 生词会动态添加到这里 -->
                </div>
                <div id="noUnknownWords" class="text-center py-8 text-slate-500 dark:text-slate-400">
                    还没有标记生词，点击文章中的单词来标记
                </div>
            </div>
        </div>
    </main>

    <!-- AI提示模态框 -->
    <div id="aiPromptModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 animate-fade-in">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-200 dark:border-slate-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-slate-800 dark:text-white">AI练习句子生成提示</h3>
                    <button id="closeAIPromptModal" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">复制以下提示到AI工具：</label>
                    <div class="relative">
                        <textarea id="aiPromptText" class="w-full p-4 border border-slate-300 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-white font-mono text-sm min-h-[200px] resize-none" readonly></textarea>
                        <button id="copyAIPromptBtn" class="absolute top-2 right-2 bg-primary hover:bg-primary/90 text-white px-3 py-1 rounded-lg text-sm transition-all duration-200">
                            <i class="fa fa-copy mr-1"></i>复制
                        </button>
                    </div>
                </div>
                <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4">
                    <div class="flex items-start">
                        <i class="fa fa-lightbulb-o text-yellow-600 dark:text-yellow-400 mt-1 mr-3"></i>
                        <div class="text-sm text-yellow-800 dark:text-yellow-300">
                            <p class="mb-2"><strong>使用建议：</strong></p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>可将此提示复制到ChatGPT、Claude等AI工具</li>
                                <li>AI会生成包含所有生词的简单句子</li>
                                <li>句子难度适合英语基础一般的学习者</li>
                                <li>每个句子独立，便于单独学习</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 帮助模态框 -->
    <div id="helpModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 animate-fade-in">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-3xl w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-200 dark:border-slate-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-slate-800 dark:text-white">使用帮助</h3>
                    <button id="closeHelpModal" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="space-y-6">
                    <div>
                        <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-3 flex items-center">
                            <i class="fa fa-upload mr-2 text-primary"></i>上传文章
                        </h4>
                        <p class="text-slate-600 dark:text-slate-300">点击上传区域或拖放.txt文件来加载英语文章。系统会自动处理文章内容。</p>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-3 flex items-center">
                            <i class="fa fa-mouse-pointer mr-2 text-primary"></i>标记生词
                        </h4>
                        <p class="text-slate-600 dark:text-slate-300">点击文章中的任意单词即可标记为生词。生词会以黄色背景高亮显示。</p>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-3 flex items-center">
                            <i class="fa fa-language mr-2 text-primary"></i>查看翻译
                        </h4>
                        <p class="text-slate-600 dark:text-slate-300">点击每个句子下方的"显示翻译"按钮查看中文翻译，或使用"显示全部翻译"按钮查看所有句子的翻译。</p>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-3 flex items-center">
                            <i class="fa fa-magic mr-2 text-primary"></i>生成练习
                        </h4>
                        <p class="text-slate-600 dark:text-slate-300">点击"生成AI练习句子"按钮，系统会创建一个提示词，可用于AI工具生成包含所有生词的练习句子。</p>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-3 flex items-center">
                            <i class="fa fa-download mr-2 text-primary"></i>导出单词
                        </h4>
                        <p class="text-slate-600 dark:text-slate-300">点击"导出生词列表"按钮可将所有标记的生词保存为.txt文件，便于复习。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed top-20 right-4 bg-white dark:bg-slate-800 shadow-lg rounded-xl p-4 max-w-sm z-50 transform translate-x-full transition-transform duration-300 animate-slide-up">
        <div class="flex items-center space-x-3">
            <div id="notificationIcon" class="w-8 h-8 rounded-full flex items-center justify-center">
                <i class="fa fa-check text-white"></i>
            </div>
            <div>
                <div id="notificationTitle" class="font-semibold text-slate-800 dark:text-white"></div>
                <div id="notificationMessage" class="text-sm text-slate-600 dark:text-slate-300"></div>
            </div>
        </div>
    </div>

    <script>
        class EnglishReader {
            constructor() {
                this.currentArticle = '';
                this.sentences = [];
                this.unknownWords = new Set();
                this.translationCache = new Map();
                
                this.initializeElements();
                this.initializeEventListeners();
                this.initializeTheme();
            }

            initializeElements() {
                // 主要区域
                this.welcomeSection = document.getElementById('welcomeSection');
                this.articleSection = document.getElementById('articleSection');
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.articleContent = document.getElementById('articleContent');
                this.unknownWordsList = document.getElementById('unknownWordsList');
                this.noUnknownWords = document.getElementById('noUnknownWords');

                // 按钮
                this.browseBtn = document.getElementById('browseBtn');
                this.loadSampleBtn = document.getElementById('loadSampleBtn');
                this.uploadAnotherBtn = document.getElementById('uploadAnotherBtn');
                this.clearAllBtn = document.getElementById('clearAllBtn');
                this.showAllTranslationsBtn = document.getElementById('showAllTranslationsBtn');
                this.hideAllTranslationsBtn = document.getElementById('hideAllTranslationsBtn');
                this.generateAIPromptBtn = document.getElementById('generateAIPromptBtn');
                this.exportWordsBtn = document.getElementById('exportWordsBtn');
                this.themeToggle = document.getElementById('themeToggle');
                this.helpBtn = document.getElementById('helpBtn');

                // 模态框
                this.aiPromptModal = document.getElementById('aiPromptModal');
                this.aiPromptText = document.getElementById('aiPromptText');
                this.closeAIPromptModal = document.getElementById('closeAIPromptModal');
                this.copyAIPromptBtn = document.getElementById('copyAIPromptBtn');
                this.helpModal = document.getElementById('helpModal');
                this.closeHelpModal = document.getElementById('closeHelpModal');

                // 统计信息
                this.wordCount = document.getElementById('wordCount');
                this.sentenceCount = document.getElementById('sentenceCount');
                this.unknownWordCount = document.getElementById('unknownWordCount');

                // 通知
                this.notification = document.getElementById('notification');
                this.notificationIcon = document.getElementById('notificationIcon');
                this.notificationTitle = document.getElementById('notificationTitle');
                this.notificationMessage = document.getElementById('notificationMessage');
            }

            initializeEventListeners() {
                // 文件上传
                this.browseBtn.addEventListener('click', () => this.fileInput.click());
                this.fileInput.addEventListener('change', (e) => this.handleFileUpload(e));
                this.uploadArea.addEventListener('dragover', (e) => this.handleDragOver(e));
                this.uploadArea.addEventListener('drop', (e) => this.handleDrop(e));
                this.uploadArea.addEventListener('dragleave', () => this.handleDragLeave());

                // 按钮事件
                this.loadSampleBtn.addEventListener('click', () => this.loadSampleArticle());
                this.uploadAnotherBtn.addEventListener('click', () => this.fileInput.click());
                this.clearAllBtn.addEventListener('click', () => this.clearAll());
                this.showAllTranslationsBtn.addEventListener('click', () => this.showAllTranslations());
                this.hideAllTranslationsBtn.addEventListener('click', () => this.hideAllTranslations());
                this.generateAIPromptBtn.addEventListener('click', () => this.generateAIPrompt());
                this.exportWordsBtn.addEventListener('click', () => this.exportUnknownWords());
                this.themeToggle.addEventListener('click', () => this.toggleTheme());
                this.helpBtn.addEventListener('click', () => this.showHelp());

                // 模态框事件
                this.closeAIPromptModal.addEventListener('click', () => this.hideAIPromptModal());
                this.copyAIPromptBtn.addEventListener('click', () => this.copyAIPrompt());
                this.closeHelpModal.addEventListener('click', () => this.hideHelpModal());

                // 点击模态框背景关闭
                this.aiPromptModal.addEventListener('click', (e) => {
                    if (e.target === this.aiPromptModal) this.hideAIPromptModal();
                });

                this.helpModal.addEventListener('click', (e) => {
                    if (e.target === this.helpModal) this.hideHelpModal();
                });

                // 键盘事件
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideAIPromptModal();
                        this.hideHelpModal();
                    }
                });
            }

            initializeTheme() {
                if (localStorage.getItem('theme') === 'dark' || 
                    (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                }
            }

            handleDragOver(e) {
                e.preventDefault();
                this.uploadArea.classList.add('dragover');
            }

            handleDragLeave() {
                this.uploadArea.classList.remove('dragover');
            }

            handleDrop(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    const file = e.dataTransfer.files[0];
                    if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                        this.processFile(file);
                    } else {
                        this.showNotification('错误', '请上传.txt格式的文件', 'error');
                    }
                }
            }

            handleFileUpload(e) {
                const file = e.target.files[0];
                if (file) {
                    this.processFile(file);
                }
            }

            processFile(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.currentArticle = e.target.result;
                    this.processArticle();
                };
                reader.onerror = () => {
                    this.showNotification('错误', '文件读取失败', 'error');
                };
                reader.readAsText(file);
            }

            loadSampleArticle() {
                const sampleArticle = `The Internet has revolutionized the way we live, work, and communicate. It has opened up a world of information and opportunities that were previously unimaginable. With just a few clicks, we can access knowledge from around the globe, connect with people on the other side of the world, and conduct business transactions instantly.

However, the Internet also presents challenges. Privacy concerns have become increasingly important as more personal information is shared online. Cybersecurity threats, such as hacking and identity theft, are on the rise. Additionally, the abundance of information can be overwhelming, making it difficult to distinguish between reliable sources and misinformation.

Despite these challenges, the Internet continues to evolve and improve our lives in countless ways. It has transformed education, healthcare, entertainment, and many other aspects of modern society. As technology advances, we can expect even more innovations that will further enhance our digital experiences.`;
                
                this.currentArticle = sampleArticle;
                this.processArticle();
            }

            processArticle() {
                // 清空之前的内容
                this.sentences = [];
                this.unknownWords.clear();
                this.translationCache.clear();

                // 分割句子（基本的句子分割逻辑）
                const sentenceEndings = /([.!?])\s+/g;
                const sentences = this.currentArticle.replace(sentenceEndings, '$1|').split('|');
                
                // 过滤空句子
                this.sentences = sentences.filter(sentence => sentence.trim().length > 0);
                
                // 更新统计信息
                this.updateStatistics();
                
                // 显示文章内容
                this.displayArticle();
                
                // 切换到文章区域
                this.welcomeSection.classList.add('hidden');
                this.articleSection.classList.remove('hidden');
                
                this.showNotification('成功', '文章加载完成', 'success');
            }

            displayArticle() {
                this.articleContent.innerHTML = '';
                
                this.sentences.forEach((sentence, index) => {
                    const sentenceDiv = document.createElement('div');
                    sentenceDiv.className = 'sentence-item p-6 border border-slate-200 dark:border-slate-700 rounded-xl hover:border-primary/50 transition-all duration-300';
                    
                    // 句子编号
                    const sentenceNumber = document.createElement('div');
                    sentenceNumber.className = 'text-sm font-bold text-primary mb-3 flex items-center';
                    sentenceNumber.innerHTML = `<i class="fa fa-list-ol mr-2"></i>句子 ${index + 1}`;
                    
                    // 句子内容
                    const sentenceContent = document.createElement('div');
                    sentenceContent.className = 'text-lg text-slate-800 dark:text-white leading-relaxed mb-4';
                    sentenceContent.innerHTML = this.highlightWords(sentence);
                    
                    // 翻译按钮和内容
                    const translationDiv = document.createElement('div');
                    translationDiv.className = 'mt-4';
                    
                    const translateBtn = document.createElement('button');
                    translateBtn.className = 'bg-secondary/10 hover:bg-secondary/20 text-secondary px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 hover-scale';
                    translateBtn.innerHTML = '<i class="fa fa-language mr-2"></i>显示翻译';
                    translateBtn.addEventListener('click', () => this.toggleTranslation(sentence, index, translationDiv));
                    
                    const translationContent = document.createElement('div');
                    translationContent.className = 'translation-content mt-3 p-4 bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700';
                    
                    translationDiv.appendChild(translateBtn);
                    translationDiv.appendChild(translationContent);
                    
                    sentenceDiv.appendChild(sentenceNumber);
                    sentenceDiv.appendChild(sentenceContent);
                    sentenceDiv.appendChild(translationDiv);
                    
                    this.articleContent.appendChild(sentenceDiv);
                });
            }

            highlightWords(sentence) {
                // 简单的单词分割（基于空格）
                const words = sentence.split(/\s+/);
                return words.map(word => {
                    // 保留标点符号
                    const cleanWord = word.replace(/[^\w]/g, '').toLowerCase();
                    const isUnknown = this.unknownWords.has(cleanWord);
                    
                    return `<span class="word${isUnknown ? ' word-highlight' : ''}" data-word="${cleanWord}">${word}</span>`;
                }).join(' ');
            }

            async toggleTranslation(sentence, index, translationDiv) {
                const translationContent = translationDiv.querySelector('.translation-content');
                const translateBtn = translationDiv.querySelector('button');
                
                if (translationContent.classList.contains('show')) {
                    translationContent.classList.remove('show');
                    translateBtn.innerHTML = '<i class="fa fa-language mr-2"></i>显示翻译';
                    return;
                }
                
                try {
                    translateBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>翻译中...';
                    translateBtn.disabled = true;
                    
                    let translation = this.translationCache.get(sentence);
                    if (!translation) {
                        // 使用百度翻译API
                        translation = await this.translateText(sentence);
                        this.translationCache.set(sentence, translation);
                    }
                    
                    translationContent.innerHTML = `
                        <div class="flex items-start">
                            <i class="fa fa-comment-o text-secondary mr-3 mt-1"></i>
                            <div class="text-slate-700 dark:text-slate-300">${translation}</div>
                        </div>
                    `;
                    translationContent.classList.add('show');
                    translateBtn.innerHTML = '<i class="fa fa-eye-slash mr-2"></i>隐藏翻译';
                    
                } catch (error) {
                    translationContent.innerHTML = `
                        <div class="flex items-start">
                            <i class="fa fa-exclamation-triangle text-error mr-3 mt-1"></i>
                            <div class="text-slate-700 dark:text-slate-300">翻译失败，请稍后重试</div>
                        </div>
                    `;
                    translationContent.classList.add('show');
                    translateBtn.innerHTML = '<i class="fa fa-language mr-2"></i>重试翻译';
                } finally {
                    translateBtn.disabled = false;
                }
            }

            async translateText(text) {
                // 百度翻译API
                const appId = '20250924002463275';
                const appKey = 'qeBt2q63Jj6yRAgZ3n4Z';
                
                if (!appId || !appKey) {
                    return "请配置百度翻译API密钥";
                }
                
                const salt = Date.now();
                const sign = this.md5(appId + text + salt + appKey);
                
                const url = `https://fanyi-api.baidu.com/api/trans/vip/translate?q=${encodeURIComponent(text)}&from=en&to=zh&appid=${appId}&salt=${salt}&sign=${sign}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.trans_result && data.trans_result[0]) {
                    return data.trans_result[0].dst;
                } else {
                    throw new Error(data.error_msg || '翻译失败');
                }
            }

            md5(string) {
                // 简单的MD5实现（用于百度翻译API签名）
                const cryptoObj = window.crypto || window.msCrypto;
                if (cryptoObj && cryptoObj.subtle) {
                    const encoder = new TextEncoder();
                    const data = encoder.encode(string);
                    return cryptoObj.subtle.digest('MD5', data).then(digest => {
                        return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, '0')).join('');
                    });
                }
                // 备用的简单哈希实现
                let hash = 0;
                for (let i = 0; i < string.length; i++) {
                    const char = string.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString(16);
            }

            showAllTranslations() {
                const translateButtons = document.querySelectorAll('.sentence-item button');
                translateButtons.forEach(btn => {
                    if (btn.innerHTML.includes('显示翻译')) {
                        btn.click();
                    }
                });
                this.showNotification('完成', '已显示所有翻译', 'success');
            }

            hideAllTranslations() {
                const translateButtons = document.querySelectorAll('.sentence-item button');
                translateButtons.forEach(btn => {
                    if (btn.innerHTML.includes('隐藏翻译')) {
                        btn.click();
                    }
                });
                this.showNotification('完成', '已隐藏所有翻译', 'success');
            }

            updateStatistics() {
                const totalWords = this.currentArticle.split(/\s+/).filter(word => word.length > 0).length;
                const totalSentences = this.sentences.length;
                const totalUnknownWords = this.unknownWords.size;
                
                this.wordCount.textContent = totalWords;
                this.sentenceCount.textContent = totalSentences;
                this.unknownWordCount.textContent = totalUnknownWords;
                
                // 更新生词列表
                this.updateUnknownWordsList();
            }

            updateUnknownWordsList() {
                this.unknownWordsList.innerHTML = '';
                
                if (this.unknownWords.size === 0) {
                    this.noUnknownWords.classList.remove('hidden');
                    return;
                }
                
                this.noUnknownWords.classList.add('hidden');
                
                Array.from(this.unknownWords).forEach(word => {
                    const wordTag = document.createElement('div');
                    wordTag.className = 'bg-error/10 text-error px-4 py-2 rounded-full text-sm font-medium flex items-center hover:bg-error/20 transition-all duration-200 hover-scale cursor-pointer';
                    wordTag.innerHTML = `
                        ${word}
                        <button class="ml-2 text-error/70 hover:text-error" onclick="event.stopPropagation(); reader.removeUnknownWord('${word}')">
                            <i class="fa fa-times"></i>
                        </button>
                    `;
                    wordTag.addEventListener('click', () => this.highlightWordInArticle(word));
                    this.unknownWordsList.appendChild(wordTag);
                });
            }

            highlightWordInArticle(word) {
                const wordElements = document.querySelectorAll(`[data-word="${word.toLowerCase()}"]`);
                wordElements.forEach(element => {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    element.classList.add('animate-pulse-slow');
                    setTimeout(() => element.classList.remove('animate-pulse-slow'), 2000);
                });
            }

            removeUnknownWord(word) {
                this.unknownWords.delete(word.toLowerCase());
                this.updateStatistics();
                this.displayArticle();
                this.showNotification('移除', `已移除生词: ${word}`, 'info');
            }

            generateAIPrompt() {
                if (this.unknownWords.size === 0) {
                    this.showNotification('提示', '请先标记一些生词', 'info');
                    return;
                }
                
                const unknownWordsArray = Array.from(this.unknownWords);
                const prompt = `请用以下英语单词各造一个简单的句子。这些句子应该适合英语基础一般的学习者，避免使用其他复杂词汇。每个句子单独一行，不需要编号。如果下面的单词不是词语的原型，请默认下面的要求是对于这些词语的原型的

生词列表：${unknownWordsArray.join(', ')}

要求：
1. 每个句子只包含一个生词
2. 句子结构简单，语法正确
3. 句子意思清晰，便于理解
4. 避免使用其他高级词汇
5. 每个句子单独成句，不需要上下文关联`;
                
                this.aiPromptText.value = prompt;
                this.aiPromptModal.classList.remove('hidden');
                this.aiPromptModal.classList.add('flex');
            }

            copyAIPrompt() {
                this.aiPromptText.select();
                document.execCommand('copy');
                this.showNotification('复制成功', 'AI提示已复制到剪贴板', 'success');
            }

            hideAIPromptModal() {
                this.aiPromptModal.classList.add('hidden');
                this.aiPromptModal.classList.remove('flex');
            }

            exportUnknownWords() {
                if (this.unknownWords.size === 0) {
                    this.showNotification('提示', '没有生词可导出', 'info');
                    return;
                }
                
                const words = Array.from(this.unknownWords).join('\n');
                const blob = new Blob([words], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = '生词列表.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification('导出成功', '生词列表已保存', 'success');
            }

            clearAll() {
                this.currentArticle = '';
                this.sentences = [];
                this.unknownWords.clear();
                this.translationCache.clear();
                
                this.articleSection.classList.add('hidden');
                this.welcomeSection.classList.remove('hidden');
                this.fileInput.value = '';
                
                this.showNotification('清空完成', '所有内容已清空', 'info');
            }

            toggleTheme() {
                document.documentElement.classList.toggle('dark');
                const isDark = document.documentElement.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            }

            showHelp() {
                this.helpModal.classList.remove('hidden');
                this.helpModal.classList.add('flex');
            }

            hideHelpModal() {
                this.helpModal.classList.add('hidden');
                this.helpModal.classList.remove('flex');
            }

            showNotification(title, message, type = 'info') {
                this.notificationTitle.textContent = title;
                this.notificationMessage.textContent = message;
                
                // 设置图标和颜色
                if (type === 'success') {
                    this.notificationIcon.className = 'w-8 h-8 bg-success rounded-full flex items-center justify-center';
                    this.notificationIcon.innerHTML = '<i class="fa fa-check text-white"></i>';
                } else if (type === 'error') {
                    this.notificationIcon.className = 'w-8 h-8 bg-error rounded-full flex items-center justify-center';
                    this.notificationIcon.innerHTML = '<i class="fa fa-times text-white"></i>';
                } else if (type === 'warning') {
                    this.notificationIcon.className = 'w-8 h-8 bg-warning rounded-full flex items-center justify-center';
                    this.notificationIcon.innerHTML = '<i class="fa fa-exclamation text-white"></i>';
                } else {
                    this.notificationIcon.className = 'w-8 h-8 bg-primary rounded-full flex items-center justify-center';
                    this.notificationIcon.innerHTML = '<i class="fa fa-info text-white"></i>';
                }
                
                // 显示通知
                this.notification.style.transform = 'translateX(0)';
                
                // 3秒后隐藏
                setTimeout(() => {
                    this.notification.style.transform = 'translateX(full)';
                }, 3000);
            }
        }

        // 等待页面加载完成
        document.addEventListener('DOMContentLoaded', () => {
            // 全局变量，方便在HTML中调用
            window.reader = new EnglishReader();
            
            // 为单词点击事件添加事件委托
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('word') || e.target.classList.contains('word-highlight')) {
                    const wordElement = e.target;
                    const word = wordElement.getAttribute('data-word').toLowerCase();
                    
                    if (wordElement.classList.contains('word-highlight')) {
                        // 取消标记
                        wordElement.classList.remove('word-highlight');
                        reader.unknownWords.delete(word);
                        reader.showNotification('取消标记', `已取消标记: ${word}`, 'info');
                    } else {
                        // 标记为生词
                        wordElement.classList.add('word-highlight');
                        reader.unknownWords.add(word);
                        reader.showNotification('标记成功', `已标记生词: ${word}`, 'success');
                    }
                    
                    reader.updateStatistics();
                }
            });
        });
    </script>
</body>
</html>
